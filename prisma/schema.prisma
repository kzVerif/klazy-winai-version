generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id          String    @id @default(cuid())
  username    String    @unique
  password    String
  email       String    @unique
  name        String?
  dateOfBirth DateTime?
  telephone   String?
  role        String    @default("user")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt 

  websites        Websites[]
  historyRents    historyRent[]
}

model Websites {
  id        String    @id @default(cuid())
  url       String    @unique
  type      String
  tenantId  String
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  websiteProducId String

  Tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  HistoryRents    historyRent[]
  WebsiteProducts WebsiteProducts @relation(fields: [websiteProducId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Users           Users[]
  Class           Class[]
  Products        Products[]
  Stocks          Stocks[]
  SuggestProducts SuggestProducts[]
  historyBuys     HistoryBuy[]
  orderSettings   OrderSetting?
  orderProducts   OrderProducts[]
  OrderPackages   OrderPackages[]
  AppPremiumSetting AppPremiumSetting?
  AppPremiums     AppPremiums[]
  HistoryBuyAppPremium HistoryBuyAppPremium[]
  SuggestAppPremiums   SuggestAppPremiums[]
  Categories      Categories[]
  SuggestCategories SuggestCategories[]
  HistoryTopup   HistoryTopup[]
  TopupTruemoney TopupTruemoney?
  TopupBank     TopupBank?
  TopupCode     TopupCode?
  Code          Code[]
  HistoryCode  HistoryCode[]
  DiscountCode DiscountCode[]
  HistoryDiscountCode HistoryDiscountCode[]
  EtcButton    EtcButton[]
  EtcButtonSetting EtcButtonSetting?
  Settings  Settings?
  SuggestOrderProducts SuggestOrderProducts[]
  HistoryBuyOrderProducts HistoryBuyOrderProducts[]
}

model historyRent {
  id         String   @id @default(cuid())
  tenantId   String
  websiteId  String
  websiteProductId String
  timeOfRent Int
  price      Float
  rentDate   DateTime @default(now())

  tenant  Tenant   @relation(fields: [tenantId], references: [id],  onDelete: Cascade, onUpdate: Cascade)
  website Websites @relation(fields: [websiteId], references: [id],  onDelete: Cascade, onUpdate: Cascade)
  websiteProduct WebsiteProducts @relation(fields: [websiteProductId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model WebsiteProducts {
  id          String   @id @default(cuid())
  productName String
  Description String
  image       String? @db.Text
  price       Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  website Websites []
  historyRents historyRent[]
}

model Users {
  id                      String                    @id @default(cuid())
  username                String
  password                String
  role                    String                    @default("user")
  points                  Float                     @default(0)
  totalPoints             Float                     @default(0)
  // เปลี่ยนชื่อตรงนี้ไม่ให้ซ้ำกับ Relation class ด้านล่าง
  userClassName           String                    @default("ไม่ทราบคลาส") 
  createdAt               DateTime                  @default(now())
  websiteId               String
  classId                 String

  website                 Websites                  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  // เพิ่มคอมม่าหน้า onDelete
  class                   Class                     @relation(fields: [classId], references: [id], onUpdate: Cascade)
  
  HistoryBuys             HistoryBuy[]
  HistoryBuyOrderProducts HistoryBuyOrderProducts[]
  HistoryBuyAppPremium    HistoryBuyAppPremium[]
  HistoryTopup            HistoryTopup[]
  HistoryCode             HistoryCode[]
  HistoryDiscountCode     HistoryDiscountCode[]
}

model Class {
  id        String   @id @default(cuid())
  className String   @default("ไม่ทราบคลาส")
  upgrade   Float    @default(0)
  isPercent Boolean  @default(false)
  reward    Float    @default(0)
  websiteId String

  Users     Users[]
  website   Websites @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Products {
  id            String  @id @default(cuid())
  name          String  @default("ไม่ทราบชื่อสินค้า")
  image         String? @db.Text
  detail        String? @db.Text
  price         Float   @default(0)
  isDiscount    Boolean @default(false)
  priceDiscount Float   @default(0)
  isPromotion   Boolean @default(false)
  buy           Int     @default(0)
  free          Int     @default(0)
  websiteId     String
  categoryId    String

  website         Websites          @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  category       Categories       @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  stocks          Stocks[]
  suggestProducts SuggestProducts[]
  historyBuys     HistoryBuy[]
}

model Stocks {
  id        String  @id @default(cuid())
  detail    String  @db.LongText
  status    Boolean @default(true)
  productId String
  websiteId String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  website     Websites     @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product     Products     @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  historyBuys HistoryBuy[]
}

model SuggestProducts {
  id        String @id @default(cuid())
  productId String
  websiteId String
  createdAt DateTime @default(now())

  website Websites @relation(fields: [websiteId], references: [id],  onDelete: Cascade, onUpdate: Cascade)
  product Products @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model HistoryBuy {
  id        String   @id @default(cuid())
  userId    String
  stockId   String
  productId String
  price     Float    @default(0)
  createdAt DateTime @default(now())
  websiteId String

website Websites @relation(fields: [websiteId], references: [id],  onDelete: Cascade, onUpdate: Cascade)
  stock   Stocks   @relation(fields: [stockId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product Products @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user    Users    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model OrderSetting {
  id        String  @id @default(cuid())
  status    Boolean @default(true)
  image     String? @db.Text
  isSuggest Boolean @default(false)
  websiteId String  @unique

  website Websites @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model OrderProducts {
  id        String  @id @default(cuid())
  name      String  @default("ไม่ทราบชื่อสินค้า")
  image     String? @db.Text
  detail    String? @db.Text
  websiteId String

  website                 Websites                  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderPackages           OrderPackages[]
  HistoryBuyOrderProducts HistoryBuyOrderProducts[]
  SuggestOrderProducts   SuggestOrderProducts[]
}

model OrderPackages {
  id             String  @id @default(cuid())
  name           String  @default("ไม่ทราบชื่อแพ็คเกจ")
  price          Float   @default(0)
  isDiscount     Boolean @default(false)
  priceDiscount  Float   @default(0)
  websiteId      String
  orderProductId String

  website                 Websites                  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderProducts           OrderProducts             @relation(fields: [orderProductId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  HistoryBuyOrderProducts HistoryBuyOrderProducts[]
}

model HistoryBuyOrderProducts {
  id             String   @id @default(cuid())
  uid            String?  @db.Text
  pass           String?  @db.Text
  contact        String?  @db.Text
  userId         String
  orderProductId String
  orderPackageId String
  price          Float  @default(0.00)
  createdAt      DateTime @default(now())
  websiteId      String
  status         String   @default("pending")
  reason         String   @default("รอทำรายการ")

  website     Websites       @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderProduct OrderProducts @relation(fields: [orderProductId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderPackage OrderPackages @relation(fields: [orderPackageId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user         Users         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model SuggestOrderProducts {
 id             String        @id @default(cuid())
 orderProductId String
 websiteId      String

 website       Websites     @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
 orderProduct   OrderProducts @relation(fields: [orderProductId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model AppPremiumSetting {
  id     String  @id @default(cuid())
  status Boolean @default(true)
  image  String? @db.Text
  key    String? @db.Text
  isSuggest Boolean @default(false)
  websiteId String  @unique

  website Websites @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model AppPremiums{
  id            String  @id @default(cuid())
  name          String  @default("ไม่ทราบชื่อสินค้า")
  price         Float   @default(0)
  isDiscount    Boolean @default(false)
  priceDiscount Float   @default(0)
  websiteId     String
  byshopId      String  @default("100")

  website         Websites         @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  HisrtoryBuyAppPremium HistoryBuyAppPremium[]
  SuggestAppPremiums   SuggestAppPremiums[]
}

model HistoryBuyAppPremium {
  id String @id @default(cuid())
  userId String
  info String @db.Text
  appPremiumId String
  price Float   @default(0)
  createdAt DateTime @default(now())
  websiteId String

website Websites @relation(fields: [websiteId], references: [id],  onDelete: Cascade, onUpdate: Cascade)
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  appPremium   AppPremiums @relation(fields: [appPremiumId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model SuggestAppPremiums{
  id           String      @id @default(cuid())
  appPremiumId String
  websiteId    String

  website       Websites     @relation(fields: [websiteId], references: [id])
  appPremium   AppPremiums @relation(fields: [appPremiumId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Categories{
  id    String  @id @default(cuid())
  name  String  @default("ไม่ทราบชื่อหมวดหมู่")
  image String? @db.Text
  websiteId String

  website   Websites          @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Products  Products[]
  SuggestCategories SuggestCategories[]
}

model SuggestCategories{
  id          String  @id @default(cuid())
  categoriesId  String
  websiteId   String

  website   Websites    @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  category  Categories  @relation(fields: [categoriesId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model HistoryTopup{
  id        String    @id @default(cuid())
  amount    Decimal   @default(0) @db.Decimal(10, 2)
  reason    String    @default("เติมเงินจากระบบ")
  topupType String    @default("ทรูวอลเลท")
  createdAt DateTime  @default(now())
  userId String
  websiteId String

  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model TopupTruemoney {
  id           String  @id @default(cuid())
  phone        String  @default("ไม่ทราบเบอร์รับเงิน")
  available    Boolean @default(false)
  feeAvailable Boolean @default(false)
  websiteId    String  @unique

  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model TopupBank {
  id           String  @id @default(cuid())
  bankAccount  String  @default("ไม่ทราบเลขที่บัญชี")
  bankName     String  @default("ไม่ทราบชื่อบัญชี")
  bankProvider String  @default("ไม่ทราบธนาคาร")
  available    Boolean @default(false)
  websiteId    String  @unique
 
  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model TopupCode {
  id        String  @id @default(cuid())
  available Boolean @default(false)
  websiteId String  @unique
  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Code {
  id              String   @id @default(cuid())
  name            String   @default("ไม่ทราบชื่อcode")
  key             String   @unique
  reward          Float    @default(0)
  currentUse      Int      @default(0)
  maxUse          Int
  canDuplicateUse Boolean  @default(false)
  createdAt       DateTime @default(now())
  expired         DateTime @default(now())
  websiteId       String

  website         Websites @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  HistoryCode     HistoryCode[]
}

model HistoryCode {
  id String @id @default(cuid())
  codeId String
  userId String
  websiteId String
  createdAt DateTime @default(now())

  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  code   Code   @relation(fields: [codeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model DiscountCode {
  id              String   @id @default(cuid())
  name            String   @default("ไม่ทราบชื่อcode")
  key             String    
  isPercent       Boolean  @default(false)
  reward          Float    @default(0)
  currentUse      Int      @default(0)
  maxUse          Int      @default(0)
  canDuplicateUse Boolean  @default(false)
  normalProduct   Boolean  @default(false)
  appPremiumProduct   Boolean  @default(false)
  orderProduct        Boolean  @default(false)
  createdAt       DateTime @default(now())
  expired         DateTime @default(now())
  websiteId       String

  website         Websites @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  HistoryDiscountCode HistoryDiscountCode[]
}

model HistoryDiscountCode {
  id String @id @default(cuid())
  codeId String
  userId String
  websiteId String
  createdAt DateTime @default(now())

  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  code   DiscountCode @relation(fields: [codeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user   Users  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model EtcButton {
   id          String  @id @default(cuid())
   image       String?  @db.Text
   link        String?  @db.Text
   websiteId   String

   website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model EtcButtonSetting {
   id          String  @id @default(cuid())
   isOpen      Boolean @default(false)
   websiteId   String  @unique
   website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Settings {
  id              String  @id @default(cuid())
  primaryColor    String  @default("#ffffff")
  secondaryColor  String  @default("#000000")
  hoverColor      String  @default("#ff0000")
  backgroundImage String? @db.Text
  webhookDiscord  String  @default("")
  shopName        String  @default("ร้านค้าไม่ทราบชื่อ")
  announcement    String  @default("")
  icon            String? @db.Text
  logo            String? @db.Text
  detail          String? @db.Text
  contact         String? @db.Text
  banner          String? @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt 
  websiteId   String @unique

  website   Websites  @relation(fields: [websiteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

